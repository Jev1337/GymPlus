{% extends 'dashboard/base.html.twig' %}
{% block content %}
        <div class="content-body">
            <div class="container-fluid">
                <div class="page-titles">
					<ol class="breadcrumb">
						<li class="breadcrumb-item"><a href="javascript:void(0)">Dashboard</a></li>
						<li class="breadcrumb-item active"><a href="javascript:void(0)">Profile</a></li>
					</ol>
                </div>
				
				<div class="alert alert-primary solid alert-right-icon alert-dismissible fade show">
					<span><i class="mdi mdi-account-search"></i></span>
					<button type="button" class="close h-100" data-dismiss="alert" aria-label="Close"><span><i class="mdi mdi-close"></i></span>
					</button><strong>Reminder:</strong> You are currently previewing the profile of <strong>{{useredit.firstname|capitalize}} {{useredit.lastname|capitalize}}</strong>. Proceed with caution.
				</div>
				{% if user.id == useredit.id %}
				<div class="alert alert-danger solid alert-right-icon alert-dismissible fade show">
					<span><i class="mdi mdi-alert"></i></span>
					<button type="button" class="close h-100" data-dismiss="alert" aria-label="Close"><span><i class="mdi mdi-close"></i></span>
					</button><strong>Reminder:</strong> You are currently editing your own profile. Please be careful with the changes you make.
				</div>
				{% endif %}
                <!-- row -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="profile card card-body px-3 pt-3 pb-0">
                            <div class="profile-head">
                                <div class="photo-content">
                                    <div class="cover-photo"></div>
                                </div>
                                <div class="profile-info">
									<div class="profile-photo" id="userphoto" style="cursor:pointer">
										<img src="{{asset('profileuploads/' ~ useredit.photo)}}" class="img-fluid rounded-circle" alt="">
									</div>
									<div class="profile-details">
										<div class="profile-name px-3 pt-2">
											<h4 class="text-primary mb-0">{{useredit.firstname|capitalize}} {{useredit.lastname|capitalize}}</h4>
											<p>{{useredit.role|capitalize}}</p>
										</div>
										<div class="profile-email px-2 pt-2">
											<h4 class="text-muted mb-0">{{useredit.email}}</h4>
											<p>Email</p>
										</div>
										<div class="dropdown ml-auto">
											<a href="#" class="btn btn-primary light sharp" data-toggle="dropdown" aria-expanded="true"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18px" height="18px" viewBox="0 0 24 24" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><rect x="0" y="0" width="24" height="24"></rect><circle fill="#000000" cx="5" cy="12" r="2"></circle><circle fill="#000000" cx="12" cy="12" r="2"></circle><circle fill="#000000" cx="19" cy="12" r="2"></circle></g></svg></a>
											<ul class="dropdown-menu dropdown-menu-right">
												<li class="dropdown-item"><i class="fa fa-user-circle text-primary mr-2"></i> View profile</li>
												<li class="dropdown-item"><i class="fa fa-users text-primary mr-2"></i> Add to close friends</li>
												<li class="dropdown-item"><i class="fa fa-plus text-primary mr-2"></i> Add to group</li>
												<li class="dropdown-item"><i class="fa fa-ban text-primary mr-2"></i> Block</li>
											</ul>
										</div>
									</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xl-4">
                        <div class="card">
                            <div class="card-body">
                                
								<div class="text-center">
									<div class="row">
										<div class="col">
											<h3 class="m-b-0">150</h3><span>Follower</span>
										</div>
										<div class="col">
											<h3 class="m-b-0">140</h3><span>Place Stay</span>
										</div>
										<div class="col">
											<h3 class="m-b-0">45</h3><span>Reviews</span>
										</div>
									</div>
									<!--
									<div class="mt-4">
										<a href="javascript:void()" class="btn btn-primary mb-1 mr-1">Follow</a> 
										<a href="javascript:void()" class="btn btn-primary mb-1" data-toggle="modal" data-target="#sendMessageModal">Send Message</a>
									</div>
									-->
								</div>


                                <div class="profile-blog mb-5">
									{% if user.role == 'admin' %}
									<form id="imageForm" action="/api/dashboard/modifyImage/{{useredit.id}}" method="post" enctype="multipart/form-data" style="display: none;">
									{% else %}
									<form id="imageForm" action="/api/modifyImage" method="post" enctype="multipart/form-data" style="display: none;">
									{% endif %}
										<input type="file" id="imageInput" name="image">
										<input type="submit" id="submitBtn">
									</form>
									
										
									<br>
									
                                    <h5 class="text-primary d-inline">About me</h5>
									<br>
                                    <hr>
                                    <h4><a href="post-details.html" class="text-black">A Highly Motivated GymRat</a></h4>
                                    <p class="mb-0">I am a highly motivated gym member who thrives on the idea that I can always be better than I was yesterday. I am writing this
									because I need to fill up the space and I am not sure what to write. Un deux trois quatre, 1337.</p>
                                </div>
                               
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-8">
					{% for message in app.flashes('error') %}
					<div class="alert alert-danger solid alert-right-icon alert-dismissible fade show">
					<span><i class="mdi mdi-alert"></i></span>
						<button type="button" class="close h-100" data-dismiss="alert" aria-label="Close"><span><i class="mdi mdi-close"></i></span>
					</button>
					<strong>Error!</strong> {{ message }}
				</div>
				{% endfor %}
                        <div class="card">
                            <div class="card-body">
							
                                <div class="profile-tab">
                                    <div class="custom-tab-1">
									
                                        <ul class="nav nav-tabs">
                                            <li class="nav-item"><a href="#profile-settings" data-toggle="tab" class="nav-link active">Account Settings</a>
                                            </li>
                                        </ul>
                                        <div class="tab-content">
        
          
                                            <div id="profile-settings" class="tab-pane fade active show">
                                                <div class="pt-3">
                                                    <div class="settings-form">
                                                        <h4 class="text-primary"></h4>
                                                        {{ form_start(form, {'attr': {'id': 'modifyForm'}}) }}
                                                            <div class="form-row">
																
                                                                <div class="form-group col-md-4">
                                                                    {{ form_label(form.username)}}
                                                                    {{ form_widget(form.username, {'attr': {'class': 'form-control'}}) }}
                                                                </div>
                                                                <div class="form-group col-md-4">
                                                                    {{ form_label(form.firstname)}}
                                                                    {{ form_widget(form.firstname, {'attr': {'class': 'form-control'}}) }}
                                                                </div>
																<div class="form-group col-md-4">
																	{{ form_label(form.lastname)}}
																	{{ form_widget(form.lastname, {'attr': {'class': 'form-control'}}) }}
																</div>
                                                            </div>
															<div class="form-row">
																<div class="form-group col-md-4">
																	{{ form_label(form.dateNaiss)}}
																	{{ form_widget(form.dateNaiss, {'attr': {'class': 'form-control'}}) }}
																</div>
																<div class="form-group col-md-4">
																	{{ form_label(form.numTel)}}
																	{{ form_widget(form.numTel, {'attr': {'class': 'form-control'}}) }}
																</div>
																<div class="form-group col-md-4">
																	{{ form_label(form.adresse)}}
																	{{ form_widget(form.adresse, {'attr': {'class': 'form-control'}}) }}
																</div>
															</div>
                                                            {{form_widget(form.submit, {'attr': {'class': 'btn btn-primary'}})}}
                                                            
                                                        {{ form_end(form) }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
									<!-- Modal -->
									<div class="modal fade" id="replyModal">
										<div class="modal-dialog modal-dialog-centered" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title">Post Reply</h5>
													<button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
												</div>
												<div class="modal-body">
													<form>
														<textarea class="form-control" rows="4">Message</textarea>
													</form>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-danger light" data-dismiss="modal">Close</button>
													<button type="button" class="btn btn-primary">Reply</button>
												</div>
											</div>
										</div>
									</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--**********************************
            Content body end
        ***********************************-->

{% endblock %}

{% block js %}
	{{ parent() }}
	<script>

		{% if user.role == 'staff' %}
			document.getElementById('modifyForm').addEventListener('submit', function(e) {
				
			if(document.getElementById('modify_user_numTel').value != {{ useredit.numTel }}) {
				e.preventDefault();
				const req = new XMLHttpRequest();
				const num = document.getElementById('modify_user_numTel').value;
				req.open('GET', '/api/sendSms?phone=' + document.getElementById('modify_user_numTel').value);
				req.send();
				Swal.fire({
				title: "Please enter the confirmation code",
				input: "text",
				inputAttributes: {
					autocapitalize: "off"
				},
				showCancelButton: true,
				confirmButtonText: "Confirm",
				showLoaderOnConfirm: true,
				
				preConfirm: async (code) => {
					try {
					const githubUrl = `
						/api/verifyPhone?phone=${num}&code=${code}
					`;
					const response = await fetch(githubUrl);
					if (!response.ok) {
						return Swal.showValidationMessage(`
						${JSON.stringify(await response.json())}
						`);
					}
					return response.json();
					} catch (error) {
					Swal.showValidationMessage(`
						Error validating code, please try again.
					`);
				}
			},
			allowOutsideClick: () => !Swal.isLoading()
				}).then((result) => {
				if (result.value.status === "success") {
					console.log(result);
					document.getElementById('modifyForm').submit();
				}});
			}

			});
		
		{% endif %}
		{% for message in app.flashes('success') %}
			{% if loop.first %}
				swal("Modification Successful!", "{{ message }}", "success");
			{% endif %}
		{% endfor %}
		
		document.getElementById('userphoto').addEventListener('click', function() {
			document.getElementById('imageInput').click();
		});
		document.getElementById('imageInput').addEventListener('change', function() {
			document.getElementById('submitBtn').click();
		});
	</script>
	
{% endblock %}