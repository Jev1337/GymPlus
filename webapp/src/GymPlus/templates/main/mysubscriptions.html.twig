{% extends 'main/base.html.twig' %}
{% block content %}
	<div class="page-content bg-white">
		
		<!-- Banner  -->
		<div class="dz-bnr-inr style-2" style="background-image: url('{{asset('main/images/banner/banner-2.png')}}')">
			<div class="banner-gradient"></div>
			<div class="container">
				<div class="row">
					<div class="col-lg-8">
						<div class="dz-bnr-inr-entry">
							<h1>My Subscriptions</h1>
							<!-- Breadcrumb Row -->
							<nav aria-label="breadcrumb" class="breadcrumb-row">
								<ul class="breadcrumb">
									<li class="breadcrumb-item"><a href="index.html">Home</a></li>
									<li class="breadcrumb-item active" aria-current="page">My Subscriptions</li>
								</ul>
							</nav>
							<!-- Breadcrumb Row End -->
						</div>
					</div>
				</div>	
				<div class="banner-media">
					<img src="{{asset('main/images/banner/pic4.png')}}" alt="/">
				</div>
			</div>	
		</div>
		<!-- Banner End -->
		
		<section class="content-inner">
			<div class="container clearfix">
				<div class="alert bg-info text-white alert-dismissible fade show">
							<svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
							<strong>Info!</strong> You currently have {{diff}} days left on your subscription. Thank you for choosing us.

							<button type="button" class="close h-100" data-bs-dismiss="alert" aria-label="Close">
									<span><i class="fa-solid fa-xmark"></i></span>
							</button>
				</div>
				<div id="masonry" class="row" data-masonry='{"percentPosition": true}'>
					<div class="card-container col-lg-12 col-md-6">
						<div class="widget bg-white p-a20">
							<div class="widget-title">
								<h4 class="title">My Subscriptions</h4>
							</div>
							<div class="widget-about">
								<div class="dz-box">
								<!-- 
									<div class="dz-media" id="userphoto" style="cursor: pointer">
										
										<img src="{{asset('profileuploads/' ~ app.user.photo)}}"  alt="">
									</div>
									-->
									<div class="dz-info m-t15">
										<h5 class="dz-title">Active Subscription</h5>
										<p class="m-b10 font-14">You currently have an active subscription with us. You can view the details below.</p>
									</div>
									<hr class="m-b15">
									<div class="dz-info m-t15">
										<div class="row">
											<div class="col-md-6">
												<h5 class="dz-title">Subscription Details</h5>
												<p class="m-b10 font-14">Subscription Plan: <span class="font-weight-500">{{subnow.type.name}}</span></p>
												<p class="m-b10 font-14">Subscription Price: <span class="font-weight-500">${{subnow.type.prix}}</span></p>
												<p class="m-b10 font-14">Subscription Expiry Date: <span class="font-weight-500">{{subnow.datefinab|date("m/d/Y")}}</span></p>
												<!-- download codes -->
												<div class="m-b10 font-14">
													<a href="javascript:void(0);" onclick="downloadCodes()">Download QR Access Code</a>
												</div>
											</div>
											<div class="col-md-6">
												<h5 class="dz-title">Access Codes</h5>
												<!-- Access Codes with QR and HTML -->
												<div class="m-b10 font-14">
													<img width = "125" height = "100" src="https://barcodeapi.org/api/qr/{{app.user.id}}" alt="QR Code" class="img-fluid">
													<img width = "185" height = "100" src="https://barcodeapi.org/api/128/{{app.user.id}}" alt="QR Code" class="img-fluid">
												</div>
											</div>
										</div>
									</div>		
									<hr class="m-b15">
									<div class="dz-info m-t15">
										<h5 class="dz-title">Subscription History</h5>
										<p class="m-b10 font-14">You can view your subscription history below.</p>
										<div class="accordion dz-accordion accordion-sm" id="accordionFaq">
										<div class="accordion-item wow fadeInUp" data-wow-delay="0.3s" style="visibility: visible; animation-delay: 0.3s; animation-name: fadeInUp;">
											<h2 class="accordion-header" id="headingOne">
												<a href="#" class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
													Subscription History
													<span class="toggle-close"></span>
												</a>
											</h2>
											<div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionFaq">
												<div class="accordion-body">
													<div class="table-responsive">
														<table class="table table-striped">
															<thead>
																<tr>
																	<th scope="col">S/N</th>
																	<th scope="col">Subscription Plan</th>
																	<th scope="col">Subscription Price</th>
																	<th scope="col">Subscription Expiry Date</th>
																</tr>
															</thead>
															<tbody>
																{% for sub in subs %}
																	<tr>
																		<td>{{sub.id}}</td>
																		<td>{{sub.type.name}}</td>
																		<td>${{sub.type.prix}}</td>
																		<td>{{sub.datefinab|date("m/d/Y")}}</td>
																	</tr>
																{% endfor %}
															</tbody>
														</table>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>
	<!-- Content END-->

	<!-- Call To Action -->
		<section class="call-action style-2 bg-img-fix bg-primary">
			<div class="container">
				<div class="inner-content">
					<div class="row justify-content-between align-items-center">
						<div class="text-center text-lg-start col-xl-6 m-lg-b20 wow fadeInUp" data-wow-delay="0.2s" style="visibility: visible; animation-delay: 0.2s; animation-name: fadeInUp;">
							<h2 class="title m-0"><span class="font-weight-400">Subscribe To Our </span>Newsletter</h2>
						</div>
						<div class="text-center text-lg-end col-xl-6 wow fadeInUp" data-wow-delay="0.4s" style="visibility: visible; animation-delay: 0.4s; animation-name: fadeInUp;">
							<form class="dzSubscribe" action="{{asset('script/mailchamp.php')}}" method="post">
								<div class="dzSubscribeMsg"></div>
								<div class="form-group">
									<div class="input-group mb-0"> 
										<div class="input-skew">
											<input name="dzEmail" required="required" type="email" class="form-control" placeholder="Your Email Address">
										</div>
										<div class="input-group-addon">
											<button name="submit" value="Submit" type="submit" class="btn btn-secondary btn-lg btn-skew h-100"><span class="skew-inner"><span class="text">Subscribe Now</span></span></button>
										</div>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</section>
		<!-- Call To Action -->
					

{% endblock %}

{% block js %}
	{{ parent() }}
	<script>
		function downloadCodes(){
			// URL of the image
const imageUrl = 'https://barcodeapi.org/api/qr/12341232';

// Fetch the image
fetch(imageUrl)
    .then(response => response.blob()) // get the image as Blob
    .then(blob => {
        // Create a new object URL for the blob
        const url = window.URL.createObjectURL(blob);

        // Create a link and set the URL
        const link = document.createElement('a');
        link.href = url;

        // Set the download attribute of the link
        link.setAttribute('download', 'qrcode.png');

        // Append the link to the body
        document.body.appendChild(link);

        // Simulate a click on the link
        link.click();

        // Remove the link from the body
        document.body.removeChild(link);
    })
    .catch(error => console.error(error));
			
		}
	</script>
{% endblock %}